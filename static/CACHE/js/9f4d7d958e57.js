function createPageChooser(id,pageTypes,openAtParentId,canChooseRoot){var chooserElement=$('#'+id+'-chooser');var pageTitle=chooserElement.find('.title');var input=$('#'+id);var editLink=chooserElement.find('.edit-link');$('.action-choose',chooserElement).click(function(){var initialUrl=window.chooserUrls.pageChooser;if(openAtParentId){initialUrl+=openAtParentId+'/';}
var urlParams={page_type:pageTypes.join(',')};if(canChooseRoot){urlParams.can_choose_root='true';}
ModalWorkflow({url:initialUrl,urlParams:urlParams,responses:{pageChosen:function(pageData){input.val(pageData.id);openAtParentId=pageData.parentId;pageTitle.text(pageData.title);chooserElement.removeClass('blank');editLink.attr('href',pageData.editUrl);}}});});$('.action-clear',chooserElement).click(function(){input.val('');openAtParentId=null;chooserElement.addClass('blank');});}
function buildExpandingFormset(prefix,opts){if(!opts){opts={};}
var addButton=$('#'+prefix+'-ADD');var formContainer=$('#'+prefix+'-FORMS');var totalFormsInput=$('#'+prefix+'-TOTAL_FORMS');var formCount=parseInt(totalFormsInput.val(),10);if(opts.onInit){for(var i=0;i<formCount;i++){opts.onInit(i);}}
var emptyFormTemplate=document.getElementById(prefix+'-EMPTY_FORM_TEMPLATE');if(emptyFormTemplate.innerText){emptyFormTemplate=emptyFormTemplate.innerText;}else if(emptyFormTemplate.textContent){emptyFormTemplate=emptyFormTemplate.textContent;}
addButton.click(function(){if(addButton.hasClass('disabled'))return false;var newFormHtml=emptyFormTemplate.replace(/__prefix__/g,formCount).replace(/<-(-*)\/script>/g,'<$1/script>');formContainer.append(newFormHtml);if(opts.onAdd)opts.onAdd(formCount);if(opts.onInit)opts.onInit(formCount);formCount++;totalFormsInput.val(formCount);});}
function ModalWorkflow(opts){var self={};var responseCallbacks=opts.responses||{};$('body > .modal').remove();var container=$('<div class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <button type="button" class="close icon text-replace icon-cross" data-dismiss="modal" aria-hidden="true">&times;</button>\n            <div class="modal-body"></div>\n        </div><!-- /.modal-content -->\n    </div><!-- /.modal-dialog -->\n</div>');$('body').append(container);container.modal('hide');self.body=container.find('.modal-body');self.loadUrl=function(url,urlParams){$.get(url,urlParams,self.loadResponseText,'text');};self.postForm=function(url,formData){$.post(url,formData,self.loadResponseText,'text');};self.ajaxifyForm=function(formSelector){$(formSelector).each(function(){var action=this.action;if(this.method.toLowerCase()=='get'){$(this).submit(function(){self.loadUrl(action,$(this).serialize());return false;});}else{$(this).submit(function(){self.postForm(action,$(this).serialize());return false;});}});};self.loadResponseText=function(responseText){var response=eval('('+responseText+')');self.loadBody(response);};self.loadBody=function(response){if(response.html){self.body.html(response.html);container.modal('show');}
if(response.onload){response.onload(self);}};self.respond=function(responseType){if(responseType in responseCallbacks){args=Array.prototype.slice.call(arguments,1);responseCallbacks[responseType].apply(self,args);}};self.close=function(){container.modal('hide');};self.loadUrl(opts.url,opts.urlParams);return self;}
$(function(){buildExpandingFormset('id_page_permissions',{onInit:function(index){var deleteInputId='id_page_permissions-'+index+'-DELETE';var childId='inline_child_page_permissions-'+index;$('#'+deleteInputId+'-button').click(function(){$('#'+deleteInputId).val('1');$('#'+childId).fadeOut();});}});});